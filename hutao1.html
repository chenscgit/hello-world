<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes" />
    <title>计算器</title>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <style>
        td{padding:3px;font-size: 20px}
        input{font-size: 20px}
    </style>
</head>
<body>
<h2 align="center">胡桃伤害计算(填圣遗物面板)</h2>
<br/>
<table style="margin: auto">
    <tr>
        <td>生命值：</td>
        <td><input id="hpEx" size="10" placeholder="生命值" value="15518"/></td>
    </tr>
    <tr>
        <td>攻击力：</td>
        <td><input id="atkEx" size="10" placeholder="攻击力" value="377"/></td>
    </tr>
    <tr>
        <td>元素精通：</td>
        <td><input id="masterEx" size="10" placeholder="元素精通" value="154"/></td>
    </tr>
    <tr>
        <td>暴击率：</td>
        <td><input id="criEx" size="10" placeholder="暴击率" value="59.9"/></td>
    </tr>
    <tr>
        <td>暴击伤害：</td>
        <td><input id="criDmgEx" size="10" placeholder="暴击伤害" value="94.0"/></td>
    </tr>
    <tr>
        <td>怪物等级：</td>
        <td><input id="monsterLevel" size="10" placeholder="怪物等级" value="90"/></td>
    </tr>
    <tr>
        <td>怪物抗性：</td>
        <td><input id="eleRes" size="10" placeholder="怪物抗性" value="10"/></td>
    </tr>
    <tr>
        <td>普攻等级：</td>
        <td><input id="aLevel" size="10" placeholder="普攻等级" value="10"/></td>
    </tr>
    <tr>
        <td>战技等级：</td>
        <td><input id="eLevel" size="10" placeholder="战技等级" value="13"/></td>
    </tr>
    <tr>
        <td>护摩精炼：</td>
        <td><input id="hmLevel" size="10" placeholder="护摩精炼" value="2"/></td>
    </tr>
    <tr>
        <td>套装类型：</td>
        <td>
            <form>
                <input type="radio" name="suit" value="0" checked>四魔女
                <input type="radio" name="suit" value="1">四追忆
            </form>
        </td>
    </tr>
    <tr>
        <td colspan="2"><button id="ok" style="margin:20px 0px;padding:10px;width:100%">计算</button></td>
    </tr>
    <tr>
        <td>暴击伤害: </td>
        <td id="dps"></td>
    </tr>
    <tr>
        <td>期望伤害: </td>
        <td id="except"></td>
    </tr>
    <tr>
        <td>未暴击伤害: </td>
        <td id="unCri"></td>
    </tr>
    <tr>
        <td>未反应伤害: </td>
        <td id="unRea"></td>
    </tr>
</table>
<br/>
<script>
$("#ok").on("click", function (event) {
    //圣遗物属性
    var hpEx = $("#hpEx").val()/1;//生命
    var atkEx = $("#atkEx").val()/1;//攻击
    var masterEx = $("#masterEx").val()/1;//精通
    var criEx = $("#criEx").val()/100;//暴击
    var criDmgEx = $("#criDmgEx").val()/100;//爆伤

    //其他信息
    var monsterLevel = $("#monsterLevel").val()/1;//怪物等级
    var eleRes = $("#eleRes").val()/1;//怪物抗性
    var aLevel = $("#aLevel").val()/1;//普攻等级
    var eLevel = $("#eLevel").val()/1;//元素战技等级
    var suit = $("input[name='suit']:checked").val()/1;//套装类型，0-四魔女，1-四追忆
    var hmLevel = $("#hmLevel").val()/1;//护摩精炼

    //基础属性（人物+武器）
    var hpBase = 15552;//生命值白字
    var atkBase = 715;//攻击力白字
    var masterBase = 0;//角色基础精通
    var criBase = 0.05;//角色基础暴击率
    var criDmgBase = 0.884;//角色基础爆伤
    var criDmgArms = 0.662;//武器爆伤

    var master = masterBase + masterEx;//面板精通
    var cri = criBase + criEx;//面板暴击
    var criDmg = criDmgBase + criDmgArms + criDmgEx;//面板爆伤

    //护摩生命buff
    var hmHpRates = [0.20, 0.25, 0.30, 0.35, 0.40];
    //护摩满血攻击buff
    var hmAtkRates = [0.008, 0.01, 0.012, 0.014, 0.016];
    //护摩半血攻击buff
    var hmHalfAtkRates = [0.01, 0.012, 0.014, 0.016, 0.018];
    //普攻技能倍率
    var aRates = [1.36, 1.452, 1.545, 1.669, 1.761, 1.869, 2.009, 2.148, 2.287, 2.426, 2.565];
    //e技能buff
    var eRates = [0.0384, 0.0407, 0.043, 0.046, 0.0483, 0.0506, 0.0536, 0.0566, 0.0596, 0.0626, 0.0656, 0.0685, 0.0715];

    //攻击力乘区
    var hp = hpBase + hpEx + hpBase * hmHpRates[hmLevel-1];//最大生命值
    var skillAtk = hp * eRates[eLevel-1];//技能加攻
    var armsAtk = hp * (hmAtkRates[hmLevel-1] + hmHalfAtkRates[hmLevel-1]);//武器加攻（半血）
    var atk = atkBase + atkEx + skillAtk + armsAtk;

    //技能倍率乘区
    var skillRate = aRates[aLevel-1];

    //增伤乘区
    var cupEleDmg = 0.466;//杯子
    var inbornEleDmg = 0.33;//天赋
    var suitEleDmg = suit === 0 ? 0.225 : 0.5;//套装
    var eleDmgRate = 1 + cupEleDmg + inbornEleDmg + suitEleDmg;

    //爆伤乘区
    var criDmgRate = 1 + criDmg;

    //反应乘区,蒸发1.5倍
    var suitMaster = suit === 0 ? 0.15 : 0;//魔女15%
    var masterRate = 278 * master / (master + 1400) / 100;//精通对增幅反应的加成
    var reactionRate = 1.5 * (1 + suitMaster + masterRate)

    //抗性乘区
    var eleResPercent = eleRes/100;
    var eleResRate = 0;
    if(eleResPercent <=0) {
        eleResRate = 1 - eleResPercent/2;
    } else if (eleResPercent > 0 && eleResPercent < 75) {
        eleResRate = 1 - eleResPercent;
    } else {
        eleResRate = 1/(4*eleResPercent + 1);
    }

    //防御乘区
    var playerLevel = 90;//玩家等级
    var monsterDef = monsterLevel * 5 + 500;//怪物防御力
    var defAddBuff = 0;//增防
    var defSubBuff = 0;//减防
    var defIgnBuff = 0;//无视
    var defRate = (playerLevel + 100) * 5 / ((playerLevel + 100) * 5 + monsterDef * ( 1 + defAddBuff - defSubBuff) * (1 + defIgnBuff));

    //暴击伤害
    var dps = atk * skillRate * eleDmgRate * eleResRate * defRate * criDmgRate * reactionRate;
    //期望伤害
    var except = dps / (1 + criDmg) * (1 + criDmg * cri);
    //未暴击伤害
    var unCri = dps / criDmgRate;
    //未反应伤害
    var unRea = dps / reactionRate;

    $("#dps").text(dps.toFixed(0));
    $("#except").text(except.toFixed(0));
    $("#unCri").text(unCri.toFixed(0));
    $("#unRea").text(unRea.toFixed(0));
});

</script>

</body>
